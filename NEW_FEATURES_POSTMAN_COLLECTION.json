{
  "info": {
    "name": "Jwalah App - New Features API Collection",
    "description": "Postman collection for Phone Login, FCM Token, and Notifications APIs",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "version": "2.0.0"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:5000",
      "type": "string"
    },
    {
      "key": "accessToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "phone",
      "value": "+1234567890",
      "type": "string"
    },
    {
      "key": "otp",
      "value": "",
      "type": "string"
    },
    {
      "key": "fcmToken",
      "value": "firebase-generated-token-string",
      "type": "string"
    },
    {
      "key": "notificationId",
      "value": "",
      "type": "string"
    }
  ],
  "auth": {
    "type": "bearer",
    "bearer": [
      {
        "key": "token",
        "value": "{{accessToken}}",
        "type": "string"
      }
    ]
  },
  "item": [
    {
      "name": "1. Phone Number Login (OTP-Based Authentication)",
      "item": [
        {
          "name": "Request OTP for Phone Login",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    pm.test(\"Status code is 200\", function () {",
                  "        pm.response.to.have.status(200);",
                  "    });",
                  "    ",
                  "    var jsonData = pm.response.json();",
                  "    pm.test(\"Response has success field\", function () {",
                  "        pm.expect(jsonData).to.have.property('success');",
                  "        pm.expect(jsonData.success).to.be.true;",
                  "    });",
                  "    ",
                  "    pm.test(\"OTP sent successfully\", function () {",
                  "        pm.expect(jsonData.message).to.include('OTP sent');",
                  "    });",
                  "    ",
                  "    console.log('‚úÖ OTP request successful');",
                  "    console.log('‚ö†Ô∏è  Check server logs for OTP (SMS simulation)');",
                  "} else if (pm.response.code === 429) {",
                  "    pm.test(\"Rate limit triggered\", function () {",
                  "        pm.response.to.have.status(429);",
                  "    });",
                  "    console.log('‚ö†Ô∏è  Rate limit exceeded');",
                  "} else {",
                  "    pm.test(\"Request failed\", function () {",
                  "        pm.expect.fail('Request failed with status: ' + pm.response.code);",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"phone\": \"{{phone}}\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/auth/request-otp-login",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "auth", "request-otp-login"]
            },
            "description": "Request a 6-digit OTP for phone number login.\n\n**Features:**\n- Rate limiting: Maximum 3 requests per hour per phone number\n- OTP expiration: 5 minutes\n- SMS simulation: OTP is logged to console (ready for Twilio integration)\n- Auto-creates user account if doesn't exist\n\n**Request Body:**\n```json\n{\n  \"phone\": \"+1234567890\"\n}\n```\n\n**Response (200 OK):**\n```json\n{\n  \"success\": true,\n  \"message\": \"OTP sent successfully\",\n  \"data\": null,\n  \"count\": 0\n}\n```\n\n**Response (429 Too Many Requests):**\n```json\n{\n  \"success\": false,\n  \"message\": \"Too many OTP requests. Please try again after X minute(s)\",\n  \"data\": {\n    \"resetTime\": \"2024-01-15T10:35:00.000Z\",\n    \"remainingMinutes\": 45\n  },\n  \"count\": 0\n}\n```"
          },
          "response": []
        },
        {
          "name": "Verify OTP and Login",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    pm.test(\"Status code is 200\", function () {",
                  "        pm.response.to.have.status(200);",
                  "    });",
                  "    ",
                  "    var jsonData = pm.response.json();",
                  "    pm.test(\"Response has success field\", function () {",
                  "        pm.expect(jsonData).to.have.property('success');",
                  "        pm.expect(jsonData.success).to.be.true;",
                  "    });",
                  "    ",
                  "    pm.test(\"Response contains access token\", function () {",
                  "        pm.expect(jsonData.data).to.have.property('accessToken');",
                  "        pm.expect(jsonData.data).to.have.property('refreshToken');",
                  "        pm.expect(jsonData.data).to.have.property('user');",
                  "    });",
                  "    ",
                  "    // Save tokens to collection variables",
                  "    if (jsonData.data.accessToken) {",
                  "        pm.collectionVariables.set('accessToken', jsonData.data.accessToken);",
                  "        console.log('‚úÖ Access token saved to collection variable');",
                  "    }",
                  "    ",
                  "    if (jsonData.data.refreshToken) {",
                  "        pm.collectionVariables.set('refreshToken', jsonData.data.refreshToken);",
                  "        console.log('‚úÖ Refresh token saved to collection variable');",
                  "    }",
                  "    ",
                  "    pm.test(\"Login successful\", function () {",
                  "        pm.expect(jsonData.message).to.include('Login successful');",
                  "    });",
                  "} else {",
                  "    pm.test(\"OTP verification failed\", function () {",
                  "        pm.expect.fail('OTP verification failed: ' + pm.response.text());",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"phone\": \"{{phone}}\",\n  \"otp\": \"{{otp}}\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/auth/verify-otp-login",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "auth", "verify-otp-login"]
            },
            "description": "Verify the OTP and complete phone number login.\n\n**Features:**\n- Validates 6-digit OTP\n- Checks OTP expiration (5 minutes)\n- Generates JWT tokens with minimal claims (user ID)\n- Updates phone verification status\n- Updates last login timestamp\n\n**Request Body:**\n```json\n{\n  \"phone\": \"+1234567890\",\n  \"otp\": \"123456\"\n}\n```\n\n**Response (200 OK):**\n```json\n{\n  \"success\": true,\n  \"message\": \"Login successful\",\n  \"data\": {\n    \"user\": {\n      \"user_id\": \"uuid\",\n      \"username\": \"user_1234567890\",\n      \"email\": \"temp_1234567890@phone.login\",\n      \"phone_verified\": true,\n      \"is_verified\": false,\n      ...\n    },\n    \"accessToken\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n    \"refreshToken\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\"\n  },\n  \"count\": 1\n}\n```\n\n**Response (400 Bad Request):**\n```json\n{\n  \"success\": false,\n  \"message\": \"Invalid OTP\" or \"OTP has expired\",\n  \"data\": null,\n  \"count\": 0\n}\n```"
          },
          "response": []
        },
        {
          "name": "Test Rate Limiting",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 429) {",
                  "    pm.test(\"Rate limit triggered correctly\", function () {",
                  "        pm.response.to.have.status(429);",
                  "    });",
                  "    ",
                  "    var jsonData = pm.response.json();",
                  "    pm.test(\"Rate limit message present\", function () {",
                  "        pm.expect(jsonData.message).to.include('Too many');",
                  "    });",
                  "    ",
                  "    console.log('‚úÖ Rate limiting is working correctly');",
                  "} else {",
                  "    console.log('‚ö†Ô∏è  Rate limit not triggered (may need more requests)');",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"phone\": \"{{phone}}\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/auth/request-otp-login",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "auth", "request-otp-login"]
            },
            "description": "Test rate limiting by making multiple requests.\n\n**Note:** Make 4 requests rapidly to trigger rate limit (max 3 per hour).\n\n**Expected Response (429):**\n```json\n{\n  \"success\": false,\n  \"message\": \"Too many OTP requests. Please try again after X minute(s)\",\n  \"data\": {\n    \"resetTime\": \"2024-01-15T10:35:00.000Z\",\n    \"remainingMinutes\": 45\n  },\n  \"count\": 0\n}\n```"
          },
          "response": []
        }
      ],
      "description": "Phone number-based authentication using OTP (One-Time Password).\n\n**Flow:**\n1. Request OTP: `POST /api/v1/auth/request-otp-login`\n2. Verify OTP: `POST /api/v1/auth/verify-otp-login`\n\n**Security:**\n- Rate limiting: 3 requests per hour per phone number\n- OTP expiration: 5 minutes\n- JWT tokens with minimal claims (user ID only)"
    },
    {
      "name": "2. FCM Token for Push Notifications",
      "item": [
        {
          "name": "Save FCM Token",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    pm.test(\"Status code is 200\", function () {",
                  "        pm.response.to.have.status(200);",
                  "    });",
                  "    ",
                  "    var jsonData = pm.response.json();",
                  "    pm.test(\"Response has success field\", function () {",
                  "        pm.expect(jsonData).to.have.property('success');",
                  "        pm.expect(jsonData.success).to.be.true;",
                  "    });",
                  "    ",
                  "    pm.test(\"FCM token saved successfully\", function () {",
                  "        pm.expect(jsonData.message).to.include('FCM token saved');",
                  "    });",
                  "    ",
                  "    console.log('‚úÖ FCM token saved successfully');",
                  "} else if (pm.response.code === 401) {",
                  "    pm.test(\"Authentication required\", function () {",
                  "        pm.response.to.have.status(401);",
                  "    });",
                  "    console.log('‚ö†Ô∏è  Authentication required - set accessToken variable');",
                  "} else {",
                  "    pm.test(\"Request failed\", function () {",
                  "        pm.expect.fail('Request failed: ' + pm.response.text());",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"fcm_token\": \"{{fcmToken}}\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/users/fcm-token",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "users", "fcm-token"]
            },
            "description": "Save or update FCM (Firebase Cloud Messaging) token for push notifications.\n\n**Features:**\n- Requires authentication (JWT Bearer token)\n- Idempotent: Can be called multiple times with same or new token\n- Token is stored in user record\n- Replaces existing token if present\n\n**Request Body:**\n```json\n{\n  \"fcm_token\": \"firebase-generated-token-string\"\n}\n```\n\n**Response (200 OK):**\n```json\n{\n  \"success\": true,\n  \"message\": \"FCM token saved successfully\",\n  \"data\": null,\n  \"count\": 0\n}\n```\n\n**Response (401 Unauthorized):**\n```json\n{\n  \"success\": false,\n  \"message\": \"Access token is required\",\n  \"data\": null,\n  \"count\": 0\n}\n```\n\n**Response (400 Bad Request):**\n```json\n{\n  \"success\": false,\n  \"message\": \"Validation failed\",\n  \"data\": [\n    {\n      \"field\": \"fcm_token\",\n      \"message\": \"FCM token is required\"\n    }\n  ],\n  \"count\": 1\n}\n```"
          },
          "response": []
        },
        {
          "name": "Update FCM Token (Idempotent Test)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    pm.test(\"Idempotent operation successful\", function () {",
                  "        pm.response.to.have.status(200);",
                  "    });",
                  "    console.log('‚úÖ FCM token update is idempotent');",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"fcm_token\": \"{{fcmToken}}\"\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/users/fcm-token",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "users", "fcm-token"]
            },
            "description": "Test idempotency by calling the same endpoint with the same token multiple times.\n\n**Expected:** Should succeed without errors, updating the token cleanly."
          },
          "response": []
        }
      ],
      "description": "Save Firebase Cloud Messaging (FCM) token for push notifications.\n\n**Endpoint:** `POST /api/v1/users/fcm-token`\n\n**Authentication:** Required (JWT Bearer token)\n\n**Features:**\n- Idempotent operation\n- Token stored in user record\n- Can be updated multiple times"
    },
    {
      "name": "3. Notifications API",
      "item": [
        {
          "name": "Get Notifications (All)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    pm.test(\"Status code is 200\", function () {",
                  "        pm.response.to.have.status(200);",
                  "    });",
                  "    ",
                  "    var jsonData = pm.response.json();",
                  "    pm.test(\"Response has success field\", function () {",
                  "        pm.expect(jsonData).to.have.property('success');",
                  "        pm.expect(jsonData.success).to.be.true;",
                  "    });",
                  "    ",
                  "    pm.test(\"Response contains notifications array\", function () {",
                  "        pm.expect(jsonData.data).to.have.property('notifications');",
                  "        pm.expect(jsonData.data).to.have.property('pagination');",
                  "    });",
                  "    ",
                  "    pm.test(\"Pagination metadata present\", function () {",
                  "        var pagination = jsonData.data.pagination;",
                  "        pm.expect(pagination).to.have.property('currentPage');",
                  "        pm.expect(pagination).to.have.property('totalPages');",
                  "        pm.expect(pagination).to.have.property('totalItems');",
                  "        pm.expect(pagination).to.have.property('itemsPerPage');",
                  "    });",
                  "    ",
                  "    // Save first notification ID for mark as read test",
                  "    if (jsonData.data.notifications && jsonData.data.notifications.length > 0) {",
                  "        var firstNotification = jsonData.data.notifications[0];",
                  "        pm.collectionVariables.set('notificationId', firstNotification.notification_id);",
                  "        console.log('‚úÖ Notification ID saved: ' + firstNotification.notification_id);",
                  "    }",
                  "    ",
                  "    console.log('‚úÖ Notifications retrieved successfully');",
                  "    console.log('Total items: ' + jsonData.data.pagination.totalItems);",
                  "} else if (pm.response.code === 401) {",
                  "    pm.test(\"Authentication required\", function () {",
                  "        pm.response.to.have.status(401);",
                  "    });",
                  "    console.log('‚ö†Ô∏è  Authentication required - set accessToken variable');",
                  "} else {",
                  "    pm.test(\"Request failed\", function () {",
                  "        pm.expect.fail('Request failed: ' + pm.response.text());",
                  "    });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/v1/notifications?page=1&limit=10",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "notifications"],
              "query": [
                {
                  "key": "page",
                  "value": "1",
                  "description": "Page number (default: 1)"
                },
                {
                  "key": "limit",
                  "value": "10",
                  "description": "Items per page (default: 10, max: 50)"
                }
              ]
            },
            "description": "Get all notifications for the authenticated user with pagination.\n\n**Query Parameters:**\n- `page` (optional, default: 1) - Page number\n- `limit` (optional, default: 10, max: 50) - Items per page\n- `type` (optional) - Filter by type: `order`, `system`, `offers`, or `other`\n\n**Response (200 OK):**\n```json\n{\n  \"success\": true,\n  \"message\": \"Notifications retrieved successfully\",\n  \"data\": {\n    \"notifications\": [\n      {\n        \"notification_id\": \"uuid\",\n        \"user_id\": \"uuid\",\n        \"type\": \"order\",\n        \"title\": \"Order Confirmed\",\n        \"message\": \"Your order #12345 has been confirmed\",\n        \"is_read\": false,\n        \"metadata\": null,\n        \"created_at\": \"2024-01-15T10:30:00.000Z\"\n      }\n    ],\n    \"pagination\": {\n      \"currentPage\": 1,\n      \"totalPages\": 5,\n      \"totalItems\": 50,\n      \"itemsPerPage\": 10,\n      \"hasNextPage\": true,\n      \"hasPrevPage\": false\n    }\n  },\n  \"count\": 10\n}\n```"
          },
          "response": []
        },
        {
          "name": "Get Notifications with Type Filter",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    pm.test(\"Status code is 200\", function () {",
                  "        pm.response.to.have.status(200);",
                  "    });",
                  "    ",
                  "    var jsonData = pm.response.json();",
                  "    pm.test(\"Notifications filtered by type\", function () {",
                  "        var notifications = jsonData.data.notifications;",
                  "        if (notifications.length > 0) {",
                  "            notifications.forEach(function(notification) {",
                  "                pm.expect(notification.type).to.equal('order');",
                  "            });",
                  "        }",
                  "    });",
                  "    console.log('‚úÖ Notifications filtered by type successfully');",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/v1/notifications?page=1&limit=10&type=order",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "notifications"],
              "query": [
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "limit",
                  "value": "10"
                },
                {
                  "key": "type",
                  "value": "order",
                  "description": "Filter by type: order, system, offers, other"
                }
              ]
            },
            "description": "Get notifications filtered by type.\n\n**Valid Types:**\n- `order` - Order-related notifications\n- `system` - System notifications\n- `offers` - Offer/promotion notifications\n- `other` - Other notifications\n\n**Response (400 Bad Request) - Invalid Type:**\n```json\n{\n  \"success\": false,\n  \"message\": \"Invalid notification type. Must be one of: order, system, offers, other\",\n  \"data\": null,\n  \"count\": 0\n}\n```"
          },
          "response": []
        },
        {
          "name": "Get Notifications - System Type",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/v1/notifications?type=system",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "notifications"],
              "query": [
                {
                  "key": "type",
                  "value": "system"
                }
              ]
            },
            "description": "Get system notifications only."
          },
          "response": []
        },
        {
          "name": "Get Notifications - Offers Type",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/v1/notifications?type=offers",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "notifications"],
              "query": [
                {
                  "key": "type",
                  "value": "offers"
                }
              ]
            },
            "description": "Get offer/promotion notifications only."
          },
          "response": []
        },
        {
          "name": "Get Notifications - Page 2",
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/v1/notifications?page=2&limit=5",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "notifications"],
              "query": [
                {
                  "key": "page",
                  "value": "2"
                },
                {
                  "key": "limit",
                  "value": "5"
                }
              ]
            },
            "description": "Get second page of notifications with 5 items per page."
          },
          "response": []
        },
        {
          "name": "Mark Notification as Read",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    pm.test(\"Status code is 200\", function () {",
                  "        pm.response.to.have.status(200);",
                  "    });",
                  "    ",
                  "    var jsonData = pm.response.json();",
                  "    pm.test(\"Notification marked as read\", function () {",
                  "        pm.expect(jsonData.data.notification.is_read).to.be.true;",
                  "    });",
                  "    ",
                  "    console.log('‚úÖ Notification marked as read');",
                  "} else if (pm.response.code === 404) {",
                  "    pm.test(\"Notification not found\", function () {",
                  "        pm.response.to.have.status(404);",
                  "    });",
                  "    console.log('‚ö†Ô∏è  Notification not found');",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "PATCH",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/v1/notifications/{{notificationId}}/mark-read",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "notifications", "{{notificationId}}", "mark-read"]
            },
            "description": "Mark a specific notification as read.\n\n**Path Parameter:**\n- `notificationId` - UUID of the notification\n\n**Response (200 OK):**\n```json\n{\n  \"success\": true,\n  \"message\": \"Notification marked as read\",\n  \"data\": {\n    \"notification\": {\n      \"notification_id\": \"uuid\",\n      \"is_read\": true,\n      ...\n    }\n  },\n  \"count\": 1\n}\n```\n\n**Response (404 Not Found):**\n```json\n{\n  \"success\": false,\n  \"message\": \"Notification not found\",\n  \"data\": null,\n  \"count\": 0\n}\n```"
          },
          "response": []
        },
        {
          "name": "Test Invalid Notification Type",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 400) {",
                  "    pm.test(\"Invalid type rejected correctly\", function () {",
                  "        pm.response.to.have.status(400);",
                  "    });",
                  "    console.log('‚úÖ Invalid type validation working');",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": [
                {
                  "key": "token",
                  "value": "{{accessToken}}",
                  "type": "string"
                }
              ]
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/v1/notifications?type=invalid",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "notifications"],
              "query": [
                {
                  "key": "type",
                  "value": "invalid"
                }
              ]
            },
            "description": "Test validation by using an invalid notification type.\n\n**Expected Response (400):**\n```json\n{\n  \"success\": false,\n  \"message\": \"Invalid notification type. Must be one of: order, system, offers, other\",\n  \"data\": null,\n  \"count\": 0\n}\n```"
          },
          "response": []
        }
      ],
      "description": "Notifications API with pagination and filtering.\n\n**Endpoint:** `GET /api/v1/notifications`\n\n**Authentication:** Required (JWT Bearer token)\n\n**Features:**\n- Pagination (page, limit, max 50 per page)\n- Filter by type (order, system, offers, other)\n- Default sort: newest first (created_at DESC)\n- Efficient database indexing\n- Mark as read functionality"
    },
    {
      "name": "Test Scenarios",
      "item": [
        {
          "name": "Complete Phone Login Flow",
          "item": [
            {
              "name": "Step 1: Request OTP",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "if (pm.response.code === 200) {",
                      "    console.log('‚úÖ Step 1: OTP requested successfully');",
                      "    console.log('‚ö†Ô∏è  Check server logs for OTP');",
                      "    console.log('üìù Next: Use the OTP in Step 2');",
                      "}"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"phone\": \"{{phone}}\"\n}",
                  "options": {
                    "raw": {
                      "language": "json"
                    }
                  }
                },
                "url": {
                  "raw": "{{baseUrl}}/api/v1/auth/request-otp-login",
                  "host": ["{{baseUrl}}"],
                  "path": ["api", "v1", "auth", "request-otp-login"]
                }
              },
              "response": []
            },
            {
              "name": "Step 2: Verify OTP and Login",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "if (pm.response.code === 200) {",
                      "    var jsonData = pm.response.json();",
                      "    if (jsonData.data.accessToken) {",
                      "        pm.collectionVariables.set('accessToken', jsonData.data.accessToken);",
                      "        console.log('‚úÖ Step 2: Login successful');",
                      "        console.log('‚úÖ Access token saved to collection variable');",
                      "        console.log('üìù Next: Use saved token for protected endpoints');",
                      "    }",
                      "}"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"phone\": \"{{phone}}\",\n  \"otp\": \"{{otp}}\"\n}",
                  "options": {
                    "raw": {
                      "language": "json"
                    }
                  }
                },
                "url": {
                  "raw": "{{baseUrl}}/api/v1/auth/verify-otp-login",
                  "host": ["{{baseUrl}}"],
                  "path": ["api", "v1", "auth", "verify-otp-login"]
                }
              },
              "response": []
            }
          ],
          "description": "Complete flow for phone number login:\n1. Request OTP\n2. Verify OTP and get access token\n\n**Note:** Set the `otp` variable after receiving OTP from server logs."
        },
        {
          "name": "Complete User Flow",
          "item": [
            {
              "name": "1. Phone Login",
              "request": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"phone\": \"{{phone}}\",\n  \"otp\": \"{{otp}}\"\n}",
                  "options": {
                    "raw": {
                      "language": "json"
                    }
                  }
                },
                "url": {
                  "raw": "{{baseUrl}}/api/v1/auth/verify-otp-login",
                  "host": ["{{baseUrl}}"],
                  "path": ["api", "v1", "auth", "verify-otp-login"]
                }
              },
              "response": []
            },
            {
              "name": "2. Save FCM Token",
              "request": {
                "auth": {
                  "type": "bearer",
                  "bearer": [
                    {
                      "key": "token",
                      "value": "{{accessToken}}",
                      "type": "string"
                    }
                  ]
                },
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"fcm_token\": \"{{fcmToken}}\"\n}",
                  "options": {
                    "raw": {
                      "language": "json"
                    }
                  }
                },
                "url": {
                  "raw": "{{baseUrl}}/api/v1/users/fcm-token",
                  "host": ["{{baseUrl}}"],
                  "path": ["api", "v1", "users", "fcm-token"]
                }
              },
              "response": []
            },
            {
              "name": "3. Get Notifications",
              "request": {
                "auth": {
                  "type": "bearer",
                  "bearer": [
                    {
                      "key": "token",
                      "value": "{{accessToken}}",
                      "type": "string"
                    }
                  ]
                },
                "method": "GET",
                "header": [],
                "url": {
                  "raw": "{{baseUrl}}/api/v1/notifications",
                  "host": ["{{baseUrl}}"],
                  "path": ["api", "v1", "notifications"]
                }
              },
              "response": []
            }
          ],
          "description": "Complete user flow:\n1. Phone login to get access token\n2. Save FCM token for push notifications\n3. Get notifications"
        }
      ],
      "description": "Test scenarios and complete flows for testing the new features."
    }
  ]
}

